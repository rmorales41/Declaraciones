{% extends "paginas/base.html" %}
{% block titulo %} Grupo de Roles  {% endblock %}
{% block contenido %}
{% load static%}

<head>
    <meta charset="UTF-8">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap5.min.css">
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- DataTables Buttons CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.bootstrap5.min.css">
</head>
<body>
<!-- jQuery y DataTables -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>

<!-- DataTables Buttons JS -->
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.colVis.min.js"></script>

<!-- Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Scripts personalizados -->
<script src="{% static 'js/Seguridad.js' %}"></script>

<!-- <body onload="StStatusDeclaraciones()"> -->


<div class="card">
    <div class="col text-right">
            <a href="{% url 'visor' %}" class="btn btn-primary"><i class="fa fa-reply"></i> Volver al menú </a>
             
        <div class="card-body">
        <h4 class="card-title">Grupo de Roles </h4>      
        <table id="VisorRoles" class="table table-striped" style="width:100%">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Fecha</th>
                        <th scope="col">Detalle</th>
                        <th scope="col">Observaciones</th>
                        <th style="width: 15%" scope="col">Acción</th>
                    </tr>
                </thead>
                <tbody>                         
                    {% for a in var_roles %}
                    <tr class="">
                        <td scope="row">{{a.IDRoles}}</td>
                        <td scope="row">{{a.Fecha_Sistema}}</td>
                        <td scope="row">{{a.Detalle}}</td>
                        <td scope="row">{{a.Observaciones}}</td>
                        <td>
                            <a name="" id="Nuevo"  class="btn btn-info"    href="{% url 'Nuevo_Rol' %}" role="button"><i class="bi bi-plus-lg"></i></a>
                            <a name="" id="Editar" class="btn btn-primary" href="{% url 'Editar_Rol' a.IDRoles %}" role="button"><i class="bi bi-pencil"></i></a>
                            <a name="" id="Borrar" class="btn btn-danger"  onclick="elimina_rol({{a.IDRoles}})" role="button"><i class="bi bi-trash"></i></a>
                        </td>                        
                    </td>
                    {% endfor %}                   
                </tbody>                           
        </table>     
                <!-- paginacion-->                                                       
                {% include "formas/paginacion.html" %} 
        </div> 
    </div>
</div>

<script> 
    // Inicializar DataTable
    $(document).ready(function () {
        $('#VisorRoles').DataTable({
            "language": {
                "url": "{% static 'json/Spanish.json' %}" 
            },
            "searching": true,  // Habilitar búsqueda global
            "ordering": true,    // Habilitar ordenamiento de columnas
            "paging": true,
            "info": true,
            "scrollX": true,
            "scrollY": "430px",
            "responsive": true,
            "autoWidth": true,
            "scrollCollapse": true,
            "stateSave": true, // permite guardar el estado de la tabla 
            "buttons": [
                'copy', 'excel', 'pdf', 'print'
                        ],
            "buttons": [
                   {
                    extend: 'colvis',
                    columns: [0, 1, 2],
                    action: function (e, dt, node, config) {
                    alert('Botón de visibilidad de columnas clicado');
                                }
                    }
                        ]                        
        });
    });
</script>

<script>
   function elimina_rol(IDD) {       
    Swal.fire({
        title: "¿Desea eliminar este rol?",
        text: "Recuerde que si tiene documentos ligados, no podrá eliminarlo.",
        icon: "warning",
        showCancelButton: true,
        cancelButtonText: "No, Cancelar",
        confirmButtonText: "Sí, Eliminar",
        reverseButtons: true,
        confirmButtonColor: "#dc3545",
        backdrop: true,
        showLoaderOnConfirm: true,
        preConfirm: () => {
            return fetch(`/Borrar_Rol/${IDD}/`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'), // Asegúrate de tener el token CSRF
                },
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Error en la eliminación');
                }
                return response.json();
            });
        }
    }).then(result => {
        if (result.isConfirmed) {
            Swal.fire("Eliminado", "El rol ha sido eliminado.", "success");
            // Opcional: recargar la página o actualizar la lista de roles
            location.reload();
        }
    }).catch(error => {
        console.error("Error al intentar eliminar el rol:", error);
        Swal.fire("Error", "Hubo un problema al procesar su solicitud.", "error");
    });
}

</script>

{% endblock %}

